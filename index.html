<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karate Запись</title>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #080808;
      color: #ffffff;
      overflow-y: auto;
      position: relative;
    }
    #tsparticles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
    a { text-decoration: none; }
    ul { list-style: none; margin: 0; padding: 0; }

    .menu-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
    }
    .menu-top .logo {
      width: 100px;
    }
    .social-links {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .social-title {
      font-size: 12px;
      font-weight: 500;
      color: #ccc;
    }
    .social-link {
      color: #d5fd02;
      font-size: 16px;
      transition: color 0.3s ease, transform 0.3s ease;
    }
    .social-link:hover {
      color: #b8e002;
      transform: scale(1.1);
    }

    .carousel {
      position: relative;
      width: 343px;
      height: 136px;
      margin: 8px auto;
      border-radius: 6px;
      overflow: hidden;
      background: #000;
      max-width: 100%;
    }
    .carousel a {
      display: block;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      transition: opacity .5s linear, transform .5s linear;
      transform: scale(1);
    }
    .carousel a.active {
      opacity: 1;
      z-index: 1;
      transform: scale(1.02);
    }
    .carousel img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .carousel .hot {
      position: absolute;
      top: 8px;
      left: 16px;
      font-size: 20px;
      font-weight: 500;
      color: #ffffff;
      z-index: 2;
    }
    .carousel-dots {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 5px;
      z-index: 2;
    }
    .carousel-dots .dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      cursor: pointer;
      transition: background .3s;
    }
    .carousel-dots .dot.active { background: #d5fd02; }

    .menu {
      display: flex;
      justify-content: center;
      background: #080808;
      padding: 6px 0;
      position: sticky;
      top: 0;
      z-index: 10;
      max-width: 100%;
    }
    .menu ul {
      display: inline-flex;
      gap: 10px;
      padding: 0 16px;
      overflow-x: auto;
      white-space: nowrap;
      scroll-behavior: smooth;
      touch-action: pan-x;
      -webkit-overflow-scrolling: touch;
    }
    .menu ul::-webkit-scrollbar { display: none; }
    .menu-item {
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      color: #ccc;
      transition: background .3s, color .3s;
    }
    .menu-item.active, .menu-item:hover {
      background: #d5fd02;
      color: #080808;
    }

    @keyframes scroll-hint {
      0% { transform: translateX(0); }
      50% { transform: translateX(-60px); }
      100% { transform: translateX(0); }
    }
    .menu ul.scroll-hint {
      animation: scroll-hint 1.5s ease-in-out 1;
    }

    .section {
      display: none;
      padding: 8px 16px;
      box-sizing: border-box;
      min-height: 100px;
    }
    .section.active {
      display: block;
      opacity: 1;
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      margin: 8px 0;
      color: #d5fd02;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      min-height: 100px;
    }

    .card {
      background: #111315;
      border: 1px solid #222;
      border-radius: 12px;
      color: #ccc;
      transition: transform .3s ease, box-shadow .3s ease;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .card:hover {
      transform: scale(1.03);
      box-shadow: 0 6px 16px rgba(213, 253, 2, 0.4);
    }

    #home .card,
    #schedule .card,
    #instructors .card {
      padding: 0;
    }

    #home .card img,
    #schedule .card img,
    #instructors .card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      display: block;
      border-radius: 12px 12px 0 0;
    }

    #schedule .grid,
    #instructors .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
    }

    .actual-list-container {
      margin: 16px 0;
      max-width: 100%;
      overflow: hidden;
      position: relative;
    }
    .actual-list {
      display: inline-flex;
      gap: 12px;
      padding: 0 16px;
      overflow-x: auto;
      white-space: nowrap;
      scroll-behavior: smooth;
      touch-action: pan-x;
      -webkit-overflow-scrolling: touch;
      width: 100%;
      box-sizing: border-box;
    }
    .actual-list::-webkit-scrollbar { display: none; }

    .actual-item {
      flex: 0 0 140px;
    }
    .actual-item .card {
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .actual-item .card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      display: block;
      border-radius: 12px 12px 0 0;
    }

    .card .text-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.7);
      padding: 6px;
      z-index: 2;
    }
    .card strong {
      display: block;
      font-size: 13px;
      color: #ffffff;
      margin-bottom: 4px;
    }
    .card p {
      font-size: 11px;
      color: #bbb;
      margin: 0;
    }

    #classes .card {
      padding: 12px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      cursor: pointer;
      background: linear-gradient(135deg, rgba(17, 19, 21, 0.5), rgba(34, 34, 34, 0.3));
      backdrop-filter: blur(8px);
      border: 1px solid rgba(213, 253, 2, 0.3);
      transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
    }
    #classes .card:hover {
      background: linear-gradient(135deg, rgba(17, 19, 21, 0.7), rgba(34, 34, 34, 0.5));
      border-color: rgba(213, 253, 2, 0.5);
      transform: scale(1.03);
      box-shadow: 0 6px 16px rgba(213, 253, 2, 0.3);
    }
    .promo-card {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, #d5fd02, #b8e022);
      padding: 10px;
      height: 48px;
      text-align: center;
      font-size: 14px;
      font-weight: 700;
      color: #080808;
      border: 2px solid rgba(213, 253, 2, 0.7);
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 8px 24px rgba(213, 253, 2, 0.5);
    }
    .promo-card:hover {
      background: linear-gradient(135deg, #b8e002, #d5fd02);
      transform: scale(1.05);
      box-shadow: 0 12px 32px rgba(213, 253, 2, 0.7);
      border-color: rgba(213, 253, 2, 1);
    }
    .promo-card i {
      font-size: 16px;
      color: #080808;
    }

    .team-carousel, .actual-list-container {
      margin: 16px 0;
      max-width: 100%;
      overflow: hidden;
      position: relative;
    }
    .team-list, .actual-list {
      display: inline-flex;
      gap: 12px;
      padding: 0 16px;
      overflow-x: auto;
      white-space: nowrap;
      scroll-behavior: smooth;
      touch-action: pan-x;
      -webkit-overflow-scrolling: touch;
      width: 100%;
      box-sizing: border-box;
    }
    .team-list::-webkit-scrollbar, .actual-list::-webkit-scrollbar { display: none; }
    .team-item {
      flex: 0 0 140px;
      padding: 8px;
      text-align: center;
      transition: transform .3s ease;
    }
    .team-item:hover { transform: scale(1.03); }
    .team-item img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 50%;
      margin: 0 auto 8px;
      display: block;
    }
    .team-item strong {
      display: block;
      font-size: 13px;
      color: #ffffff;
      margin-bottom: 4px;
    }
    .team-item p {
      font-size: 11px;
      color: #bbb;
      margin: 0;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.7);
      background: linear-gradient(135deg, rgba(17, 19, 21, 0.85), rgba(34, 34, 34, 0.65));
      backdrop-filter: blur(12px);
      border: 1px solid rgba(213, 253, 2, 0.4);
      border-radius: 16px;
      padding: clamp(12px, 3vw, 16px);
      z-index: 9999;
      color: #fff;
      max-width: 95%;
      min-width: 300px;
      max-height: 98vh;
      overflow-y: auto;
      scroll-behavior: smooth;
      box-sizing: border-box;
      opacity: 0;
      transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.6s ease, box-shadow 0.6s ease;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.7);
    }
    .modal.active {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      box-shadow: 0 20px 48px rgba(213, 253, 2, 0.4);
    }

    body.modal-open {
      overflow: hidden;
    }
    body.modal-open::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 9998;
      opacity: 0;
      transition: opacity 0.6s ease;
    }
    body.modal-open::before {
      opacity: 1;
    }

    .modal h3 {
      margin: 0 0 10px;
      color: #d5fd02;
      font-size: clamp(16px, 4vw, 18px);
    }
    .modal p {
      font-size: clamp(12px, 3.5vw, 13px);
      color: #ccc;
      margin: 6px 0;
    }
    .modal .contact-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }
    .modal .contact-button {
      padding: 8px 16px;
      background: linear-gradient(135deg, #d5fd02, #b8e002);
      color: #080808;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: clamp(12px, 3.5vw, 13px);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
      text-decoration: none;
    }
    .modal .contact-button:hover {
      background: linear-gradient(135deg, #b8e002, #d5fd02);
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(213, 253, 2, 0.3);
    }
    .modal .close-button {
      padding: 8px 16px;
      background: #222;
      color: #fff;
      border: 1px solid #444;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: clamp(12px, 3.5vw, 13px);
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    .modal .close-button:hover {
      background: #333;
      transform: scale(1.05);
    }
    .modal .contact-button i {
      font-size: 14px;
    }
    .modal .apply-form {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
      max-height: calc(98vh - 80px);
      overflow-y: auto;
      scroll-behavior: smooth;
      padding-bottom: 40px;
      scroll-margin-bottom: 40px;
      padding-right: 5px;
      box-sizing: border-box;
    }
    .modal .apply-form::-webkit-scrollbar {
      width: 4px;
    }
    .modal .apply-form::-webkit-scrollbar-thumb {
      background: rgba(213, 253, 2, 0.4);
      border-radius: 2px;
    }
    .modal .apply-form::-webkit-scrollbar-track {
      background: transparent;
    }
    .modal .apply-form select,
    .modal .apply-form input,
    .modal .apply-form textarea {
      padding: 5px;
      border: 1px solid #222;
      border-radius: 5px;
      background: #111315;
      color: #fff;
      font-family: 'Inter', sans-serif;
      font-size: clamp(12px, 3.5vw, 13px);
      box-sizing: border-box;
      width: 100%;
    }
    .modal .apply-form select {
      appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="%23ccc" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat: no-repeat;
      background-position: right 5px center;
      background-size: 12px;
    }
    .modal .apply-form textarea {
      resize: vertical;
      min-height: 60px;
    }
    .modal .apply-form button {
      padding: 5px 12px;
      background: #d5fd02;
      color: #080808;
      border: none;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      font-size: clamp(12px, 3.5vw, 13px);
      display: flex;
      align-items: center;
      gap: 5px;
      transition: background 0.3s ease, transform 0.3s ease;
      box-sizing: border-box;
    }
    .modal .apply-form button:hover {
      background: #b8e002;
      transform: scale(1.05);
    }
    .modal .apply-form .close-button {
      padding: 5px 12px;
      background: #222;
      color: #fff;
      border: 1px solid #444;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      font-size: clamp(12px, 3.5vw, 13px);
      margin-top: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: background 0.3s ease, transform 0.3s ease;
      box-sizing: border-box;
    }
    .modal .apply-form .close-button:hover {
      background: #333;
      transform: scale(1.05);
    }
    .modal .apply-form .bot-button {
      padding: 6px 14px;
      background: linear-gradient(135deg, #d5fd02, #b8e002);
      color: #080808;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: clamp(13px, 3.5vw, 14px);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
      text-decoration: none;
    }
    .modal .apply-form .bot-button:hover {
      background: linear-gradient(135deg, #b8e002, #d5fd02);
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(213, 253, 2, 0.5);
    }
    .modal .apply-form .bot-button i {
      font-size: 14px;
    }

    @media (max-width: 360px) {
      .modal {
        padding: 10px;
        max-height: 95vh;
        min-width: 280px;
      }
      .modal .apply-form {
        max-height: calc(95vh - 60px);
        gap: 6px;
        padding-bottom: 30px;
        scroll-margin-bottom: 30px;
      }
      .modal h3 {
        font-size: 14px;
      }
      .modal p {
        font-size: 11px;
      }
      .modal .contact-button,
      .modal .close-button {
        font-size: 11px;
        padding: 6px 12px;
      }
      .modal .apply-form select,
      .modal .apply-form input,
      .modal .apply-form textarea {
        font-size: 11px;
        padding: 4px;
      }
      .modal .apply-form button,
      .modal .apply-form .close-button,
      .modal .apply-form .bot-button {
        font-size: 11px;
        padding: 4px 10px;
      }
    }
    @media (max-width: 320px) {
      .modal {
        padding: 8px;
        max-height: 92vh;
        min-width: 260px;
      }
      .modal .apply-form {
        max-height: calc(92vh - 50px);
        gap: 5px;
        padding-bottom: 25px;
        scroll-margin-bottom: 25px;
      }
      .modal .contact-buttons {
        gap: 6px;
      }
    }

    .scroll-indicator {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: #d5fd02;
      transition: width .3s;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div id="tsparticles"></div>

  <div class="menu-top">
    <img class="logo" src="https://example.com/your-karate-logo.png" alt="Karate Logo" /> <!-- Замени на реальный логотип -->
    <div class="social-links">
      <span class="social-title">Наши соцсети</span>
      <a href="#" class="social-link tg-link" data-link="https://t.me/yourkaratechannel" data-social="telegram">
        <i class="fab fa-telegram-plane"></i>
      </a>
      <a href="https://www.instagram.com/yourkarateinst" target="_blank" class="social-link" data-social="instagram">
        <i class="fab fa-instagram"></i>
      </a>
    </div>
  </div>

  <div class="carousel">
    <a href="#" target="_blank" class="active">
      <img src="https://example.com/karate-banner1.jpg" alt="баннер 1" /> <!-- Замени на реальные баннеры -->
    </a>
    <a href="#" target="_blank">
      <img src="https://example.com/karate-banner2.jpg" alt="баннер 2" />
    </a>
    <div class="hot"></div>
    <div class="carousel-dots">
      <div class="dot active"></div>
      <div class="dot"></div>
    </div>
  </div>

  <nav class="menu">
    <ul>
      <li class="menu-item active" data-section="home">Главная</li>
      <li class="menu-item" data-section="schedule">Расписание</li>
      <li class="menu-item" data-section="instructors">Инструкторы</li>
      <li class="menu-item" data-section="classes">Запись</li>
    </ul>
  </nav>

  <section id="home" class="section active">
    <h2 class="section-title">АКТУАЛЬНОЕ</h2>
    <div class="actual-list-container">
      <ul class="actual-list">
        <li class="actual-item" data-aos="fade-up" data-aos-delay="100">
          <a class="card" href="#" target="_blank" data-id="actual_1" data-title="Событие 1">
            <img src="https://example.com/event1.jpg" alt="Событие 1" /> <!-- Замени изображения -->
            <div class="text-overlay">
              <strong>Событие 1</strong>
              <p>Описание события</p>
            </div>
          </a>
        </li>
        <li class="actual-item" data-aos="fade-up" data-aos-delay="100">
          <a class="card" href="#" target="_blank" data-id="actual_2" data-title="Событие 2">
            <img src="https://example.com/event2.jpg" alt="Событие 2" />
            <div class="text-overlay">
              <strong>Событие 2</strong>
              <p>Описание события</p>
            </div>
          </a>
        </li>
      </ul>
    </div>
    <div class="grid">
      <div class="promo-card" data-class-id="promo" data-aos="fade-up" data-aos-delay="100">
        <i class="fas fa-handshake"></i> Начать тренировки
      </div>
    </div>
    <h2 class="section-title">ИНСТРУКТОРЫ</h2>
    <div class="team-carousel">
      <ul class="team-list">
        <li class="team-item" data-aos="fade-up" data-aos-delay="100">
          <a href="#" class="tg-link" data-link="https://t.me/instructor1">
            <img src="https://example.com/instructor1.jpg" alt="Инструктор 1" />
            <strong>Инструктор 1</strong>
            <p>Описание</p>
          </a>
        </li>
        <li class="team-item" data-aos="fade-up" data-aos-delay="100">
          <a href="#" class="tg-link" data-link="https://t.me/instructor2">
            <img src="https://example.com/instructor2.jpg" alt="Инструктор 2" />
            <strong>Инструктор 2</strong>
            <p>Описание</p>
          </a>
        </li>
      </ul>
    </div>
  </section>

  <section id="schedule" class="section">
    <h2 class="section-title">РАСПИСАНИЕ</h2>
    <div class="grid">
      <a class="card" href="#" target="_blank" data-aos="fade-up" data-aos-delay="100">
        <img src="https://example.com/class1.jpg" alt="Занятие 1" />
        <div class="text-overlay">
          <strong>Занятие 1</strong>
          <p>Время и день</p>
        </div>
      </a>
      <a class="card" href="#" target="_blank" data-aos="fade-up" data-aos-delay="100">
        <img src="https://example.com/class2.jpg" alt="Занятие 2" />
        <div class="text-overlay">
          <strong>Занятие 2</strong>
          <p>Время и день</p>
        </div>
      </a>
    </div>
  </section>

  <section id="instructors" class="section">
    <h2 class="section-title">ИНСТРУКТОРЫ</h2>
    <div class="grid">
      <a class="card" href="#" target="_blank" data-aos="fade-up" data-aos-delay="100">
        <img src="https://example.com/instr1.jpg" alt="Инструктор 1" />
        <div class="text-overlay">
          <strong>Инструктор 1</strong>
          <p>Биография</p>
        </div>
      </a>
      <a class="card" href="#" target="_blank" data-aos="fade-up" data-aos-delay="100">
        <img src="https://example.com/instr2.jpg" alt="Инструктор 2" />
        <div class="text-overlay">
          <strong>Инструктор 2</strong>
          <p>Биография</p>
        </div>
      </a>
    </div>
  </section>

  <section id="classes" class="section">
    <h2 class="section-title">ЗАПИСЬ НА ЗАНЯТИЯ</h2>
    <div class="grid">
      <div class="card" data-class-id="beginner" data-aos="fade-up" data-aos-delay="100">
        <strong>Начинающие</strong>
        <p>Возраст: 6-12 лет</p>
        <p>Время: Пн, Ср, Пт 18:00</p>
      </div>
      <div class="card" data-class-id="intermediate" data-aos="fade-up" data-aos-delay="100">
        <strong>Средний уровень</strong>
        <p>Возраст: 13-18 лет</p>
        <p>Время: Вт, Чт 19:00</p>
      </div>
      <div class="card" data-class-id="advanced" data-aos="fade-up" data-aos-delay="100">
        <strong>Продвинутый</strong>
        <p>Возраст: 18+</p>
        <p>Время: Сб 10:00</p>
      </div>
      <div class="promo-card hr-contact" data-link="https://t.me/karateadmin" data-aos="fade-up" data-aos-delay="100">
        <i class="fab fa-telegram-plane"></i> Связаться с администратором
      </div>
    </div>
  </section>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({
      duration: 800,
      once: true,
      offset: 100
    });
    window.addEventListener('load', () => {
      AOS.refresh();
      console.log('AOS refreshed');
    });

    if (typeof tsParticles !== 'undefined') {
      tsParticles.load("tsparticles", {
        fpsLimit: 60,
        particles: {
          number: { value: 200, density: { enable: true, value_area: 800 } },
          color: { value: "#d5fd02" },
          shape: { type: "circle" },
          opacity: { value: 0.5, random: true },
          size: { value: 2, random: { enable: true, minimumValue: 0.5 } },
          links: { enable: false },
          move: {
            enable: true,
            speed: 0.5,
            direction: "none",
            random: true,
            outModes: { default: "out" }
          }
        },
        interactivity: { events: { onHover: { enable: false } }, resize: { enable: true } },
        retina_detect: true
      }).then(() => console.log('tsParticles loaded')).catch(err => console.error('tsParticles error:', err));
    } else {
      console.error('tsParticles not loaded');
    }

    function updateScrollIndicator(list) {
      const indicator = list.parentElement.querySelector('.scroll-indicator');
      if (!indicator) return;
      const maxScroll = list.scrollWidth - list.clientWidth;
      const scrollPercent = list.scrollLeft / maxScroll;
      indicator.style.width = `${scrollPercent * 100}%`;
    }

    document.querySelectorAll('.team-list, .actual-list').forEach(list => {
      const indicator = document.createElement('div');
      indicator.className = 'scroll-indicator';
      list.parentElement.appendChild(indicator);
      list.addEventListener('scroll', () => updateScrollIndicator(list));
      updateScrollIndicator(list);
    });

    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
    }

    let user_id = null, username = null, first_name = null, last_name = null;
    if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
      ({ id: user_id, username, first_name, last_name } = tg.initDataUnsafe.user);
    }

    const SHEET_ENDPOINT = 'https://script.google.com/macros/s/AKfycbx8JQ9X9AziBHf-tJuVtR8e0pAnK7-TUeGkUSn9ecRZ-U3GiYCUMF3IDTMGuFSV06T5YA/exec'; // Замени на ID твоего App Script

    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function sendToSheet(data) {
      console.log('Sending to sheet:', data);
      fetch(SHEET_ENDPOINT, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      }).catch(error => console.error('Error:', error));
    }

    function trackEvent(eventName, additional = {}) {
      sendToSheet({
        event: eventName,
        user_id,
        username,
        first_name,
        last_name,
        userAgent: navigator.userAgent,
        additional
      });
    }

    trackEvent('webapp_open');

    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', () => {
        trackEvent('nav_click', { section: item.dataset.section });
        document.querySelectorAll('.section').forEach(section => {
          section.classList.toggle('active', section.id === item.dataset.section);
        });
        document.querySelectorAll('.menu-item').forEach(i => i.classList.toggle('active', i === item));
        window.scrollTo(0, 0);
      });
    });

    document.querySelectorAll('.card, .team-item a').forEach(card => {
      card.addEventListener('click', (e) => {
        if (e.target.closest('.apply-form')) return;
        const title = card.querySelector('strong')?.innerText || 'Unknown';
        trackEvent('card_click', { title });
      });
    });

    document.querySelectorAll('.carousel a').forEach(slide => {
      slide.addEventListener('click', () => {
        const alt = slide.querySelector('img')?.getAttribute('alt') || 'Unknown';
        trackEvent('carousel_click', { slide: alt });
      });
    });

    document.querySelectorAll('.carousel-dots .dot').forEach((dot, i) => {
      dot.addEventListener('click', () => {
        trackEvent('carousel_dot_click', { slideIndex: i });
        document.querySelectorAll('.carousel a').forEach((slide, index) => {
          slide.classList.toggle('active', index === i);
        });
        document.querySelectorAll('.carousel-dots .dot').forEach((d, index) => {
          d.classList.toggle('active', index === i);
        });
      });
    });

    document.querySelectorAll('.social-link').forEach(link => {
      link.addEventListener('click', () => {
        const social = link.dataset.social;
        trackEvent('social_click', { platform: social });
      });
    });

    document.querySelectorAll('.tg-link').forEach(el => {
      el.addEventListener('click', function (e) {
        e.preventDefault();
        const link = this.dataset.link;
        if (/^https:\/\/t\.me\//.test(link) && window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.openLink(link);
        } else {
          window.open(link, '_blank');
        }
      });
    });

    const scrollableLists = document.querySelectorAll('.menu ul, .team-list, .actual-list');
    scrollableLists.forEach(list => {
      list.addEventListener('wheel', (e) => {
        e.preventDefault();
        const delta = Math.abs(e.deltaX) > Math.abs(e.deltaY) ? e.deltaX : e.deltaY;
        list.scrollLeft += delta * 2.5;
      });
    });

    const classData = {
      promo: {
        title: 'Karate Club',
        description: 'Запишитесь на занятия по карате. Мы предлагаем курсы для всех уровней и возрастов.'
      },
      beginner: {
        title: 'Начинающие',
        description: 'Занятия для новичков. Узнайте основы карате.',
        requirements: 'Возраст: 6-12 лет. Нет опыта необходим.'
      },
      intermediate: {
        title: 'Средний уровень',
        description: 'Углубленные техники для тех, кто имеет базовые навыки.',
        requirements: 'Возраст: 13-18 лет. Опыт: 1+ год.'
      },
      advanced: {
        title: 'Продвинутый',
        description: 'Сложные тренировки для опытных спортсменов.',
        requirements: 'Возраст: 18+. Опыт: 3+ года.'
      }
    };

    function renderForm(classId) {
      let formContent = `
        <label>Ваш Telegram (например, @username)</label>
        <input type="text" name="telegram" placeholder="@username" pattern="@[A-Za-z0-9_]{5,}" required>
        <label>Имя</label>
        <input type="text" name="name" placeholder="Ваше имя" required>
        <label>Возраст</label>
        <input type="number" name="age" placeholder="Ваш возраст" required>
        <label>Уровень</label>
        <select name="level" required>
          <option value="" disabled selected>Выберите уровень</option>
          <option value="Новичок">Новичок</option>
          <option value="Средний">Средний</option>
          <option value="Продвинутый">Продвинутый</option>
        </select>
        <label>Комментарии</label>
        <textarea name="comments" placeholder="Дополнительная информация"></textarea>
      `;
      return formContent;
    }

    document.querySelectorAll('.promo-card:not(.hr-contact), #classes .card').forEach(card => {
      card.addEventListener('click', () => {
        const classId = card.dataset.classId;
        const data = classData[classId];
        if (!data) return;
        trackEvent('class_view', { class: data.title });

        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
          <h3>${data.title}</h3>
          <p>${data.description || ''}</p>
          <p>${data.requirements ? '<strong>Требования:</strong><br>' + data.requirements : ''}</p>
          <form class="apply-form" action="#">
            ${renderForm(classId)}
            <button type="submit"><i class="fas fa-paper-plane"></i> Записаться</button>
            <button type="button" class="close-button"><i class="fas fa-times"></i> Закрыть</button>
          </form>
        `;

        document.body.appendChild(modal);
        setTimeout(() => modal.classList.add('active'), 10);
        document.body.classList.add('modal-open');

        modal.querySelector('.close-button').addEventListener('click', () => {
          modal.classList.remove('active');
          document.body.classList.remove('modal-open');
          setTimeout(() => modal.remove(), 600);
        });

        modal.querySelector('.apply-form')?.addEventListener('submit', (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const telegram = formData.get('telegram');
          if (!telegram || !telegram.startsWith('@')) {
            if (tg && tg.showPopup) {
              tg.showPopup({
                title: 'Ошибка',
                message: 'Ошибка в заполнении Telegram',
                buttons: [{ type: 'ok' }]
              });
            } else {
              alert('Ошибка в заполнении Telegram');
            }
            return;
          }
          const response_id = generateUUID();
          const additional = {
            id: classId,
            title: data.title,
            response_id,
            telegram: telegram,
            name: formData.get('name'),
            age: formData.get('age'),
            level: formData.get('level'),
            comments: formData.get('comments')
          };
          const eventData = {
            event: 'class_signup',
            user_id,
            username,
            first_name,
            last_name,
            timestamp: new Date().toISOString(),
            additional
          };
          sendToSheet(eventData);

          modal.querySelector('.apply-form').innerHTML = `
            <p style="text-align: center; font-size: 18px; color: #d5fd02;">Запись отправлена!</p>
            <p style="text-align: center; font-size: 15px; color: #ccc;">Мы свяжемся с вами скоро.</p>
            <a href="#" class="bot-button tg-link" data-link="https://t.me/YOUR_KARATE_BOT?start=${response_id}">
              <i class="fab fa-telegram-plane"></i> Перейти в чат
            </a>
            <button type="button" class="close-button"><i class="fas fa-times"></i> Закрыть</button>
          `;
          modal.querySelector('.close-button').addEventListener('click', () => {
            modal.classList.remove('active');
            document.body.classList.remove('modal-open');
            setTimeout(() => modal.remove(), 600);
          });

          modal.querySelectorAll('.tg-link').forEach(button => {
            button.addEventListener('click', (e) => {
              e.preventDefault();
              const link = button.dataset.link;
              if (/^https:\/\/t\.me\//.test(link) && window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.openLink(link);
              } else {
                window.open(link, '_blank');
              }
            });
          });
        });
      });
    });

    document.querySelector('.hr-contact').addEventListener('click', (e) => {
      e.preventDefault();
      const link = document.querySelector('.hr-contact').dataset.link;
      trackEvent('admin_contact_click');
      if (/^https:\/\/t\.me\//.test(link) && window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.openLink(link);
      } else {
        window.open(link, '_blank');
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        const menuList = document.querySelector('.menu ul');
        if (menuList) {
          menuList.classList.add('scroll-hint');
          setTimeout(() => {
            menuList.classList.remove('scroll-hint');
          }, 1500);
        }
      }, 500);
    });

    function startCarousel() {
      const slides = document.querySelectorAll('.carousel a');
      const dots = document.querySelectorAll('.carousel-dots .dot');
      let currentIndex = 0;
      function showSlide(index) {
        slides.forEach((slide, i) => {
          slide.classList.toggle('active', i === index);
        });
        dots.forEach((dot, i) => {
          dot.classList.toggle('active', i === index);
        });
        currentIndex = index;
      }

      function nextSlide() {
        currentIndex = (currentIndex + 1) % slides.length;
        showSlide(currentIndex);
      }

      setInterval(nextSlide, 3000);
      showSlide(currentIndex);
    }

    startCarousel();
  </script>
</body>
</html>
