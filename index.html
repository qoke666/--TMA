<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TMA Главная — The Limited Club</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">

  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --bg: #080808;
      --fg: #fff;
      --accent: #d5fd02;
      --card: #111315;
      --muted: #ccc;
      --gothic-bg: #0a0404;
      --gothic-accent: #8a0303;
      --gothic-gold: #b88b2f;
    }

    html,body{height:100%;margin:0;padding:0;}
    body{
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--fg);
      overflow-y: auto;
      position: relative;
      transition: background-color .6s ease, color .6s ease;
    }

    /* particles background */
    #tsparticles {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    a { text-decoration: none; color: inherit; }
    ul { list-style: none; margin: 0; padding: 0; }

    .menu-top{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;}
    .logo{width:100px}
    .social-links{display:flex;align-items:center;gap:8px}
    .social-title{font-size:12px;font-weight:500;color:#ccc}
    .social-link{color:var(--accent);font-size:16px;transition:color .3s,transform .3s}
    .social-link:hover{transform:scale(1.1)}

    .carousel{position:relative;width:343px;height:136px;margin:8px auto;border-radius:6px;overflow:hidden;background:#000;max-width:100%}
    .carousel a{display:block;width:100%;height:100%;position:absolute;top:0;left:0;opacity:0;transition:opacity .5s linear,transform .5s linear;transform:scale(1)}
    .carousel a.active{opacity:1;z-index:1;transform:scale(1.02)}
    .carousel img{width:100%;height:100%;object-fit:cover;display:block}
    .carousel-dots{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);display:flex;gap:5px;z-index:2}
    .carousel-dots .dot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,0.3);cursor:pointer;transition:background .3s}
    .carousel-dots .dot.active{background:var(--accent)}

    .menu{display:flex;justify-content:center;background:var(--bg);padding:6px 0;position:sticky;top:0;z-index:30;max-width:100%}
    .menu ul{display:inline-flex;gap:10px;padding:0 16px;overflow-x:auto;white-space:nowrap;scroll-behavior:smooth;touch-action:pan-x}
    .menu ul::-webkit-scrollbar{display:none}
    .menu-item{padding:6px 12px;border-radius:6px;font-weight:600;font-size:14px;cursor:pointer;color:#ccc;transition:background .3s,color .3s}
    .menu-item.active,.menu-item:hover{background:var(--accent);color:var(--bg)}

    .section{display:none;padding:8px 16px;box-sizing:border-box;min-height:100px}
    .section.active{display:block;opacity:1;transition:opacity .4s ease}

    .section-title{font-size:24px;font-weight:600;margin:8px 0;color:var(--accent)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}

    .card{background:var(--card);border:1px solid #222;border-radius:12px;color:#ccc;transition:transform .3s,box-shadow .3s;position:relative;overflow:hidden;display:flex;flex-direction:column}
    .card:hover{transform:scale(1.03);box-shadow:0 6px 16px rgba(213,253,2,0.4)}

    /* modal */
    .modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.7);background:linear-gradient(135deg, rgba(17,19,21,.85), rgba(34,34,34,.65));backdrop-filter:blur(12px);border:1px solid rgba(213,253,2,.4);border-radius:16px;padding:clamp(12px,3vw,16px);z-index:9999;color:#fff;max-width:95%;min-width:300px;max-height:98vh;overflow-y:auto;scroll-behavior:smooth;opacity:0;transition:transform .6s cubic-bezier(.68,-.55,.265,1.55),opacity .6s,box-shadow .6s}
    .modal.active{transform:translate(-50%,-50%) scale(1);opacity:1}
    body.modal-open{overflow:hidden}
    body.modal-open::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);backdrop-filter:blur(10px);z-index:9998;opacity:1}

    .modal h3{margin:0 0 10px;color:var(--accent);font-size:clamp(16px,4vw,18px)}
    .modal p{font-size:clamp(12px,3.5vw,13px);color:#ccc;margin:6px 0}
    .modal .contact-button{padding:8px 16px;background:linear-gradient(135deg,var(--accent),#b8e002);color:#080808;border:none;border-radius:6px;font-weight:600;cursor:pointer}
    .modal .close-button{padding:8px 16px;background:#222;color:#fff;border:1px solid #444;border-radius:6px;font-weight:600;cursor:pointer}

    /* goth styles */
    .gothic {
      --bg: var(--gothic-bg);
      --fg: #f4eee6;
      --accent: var(--gothic-accent);
      --card: #0f0b0b;
      --muted: #d8c9b0;
    }

    .event-hero {
      margin: 18px 0;
      padding: 24px;
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6));
      border: 2px solid rgba(138,3,3,0.2);
      position: relative;
      overflow: hidden;
      display:flex;
      gap:18px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .event-left { flex:1 1 320px; }
    .event-title {
      font-family: 'Cinzel', 'Uncial Antiqua', serif;
      font-size: clamp(22px, 4.5vw, 36px);
      color: var(--gothic-gold);
      letter-spacing: 1px;
      margin:0 0 8px 0;
    }
    .event-sub {
      color: var(--muted);
      font-size: clamp(13px,3.5vw,16px);
      margin:0 0 12px 0;
    }
    .event-cta { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btn-register {
      padding:10px 16px;
      background: linear-gradient(180deg,var(--gothic-accent),#5a0000);
      color: #fff;
      border-radius:10px;
      border: 1px solid rgba(255,255,255,0.06);
      cursor:pointer;
      font-weight:700;
      box-shadow:0 8px 24px rgba(138,3,3,0.25);
      transition:transform .2s ease;
    }
    .btn-register:hover{transform:translateY(-4px)}
    .btn-info {
      padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);cursor:pointer;
    }

    /* SVG overlay: кровь */
    .blood-overlay {
      position: fixed;
      inset: 0;
      z-index: 60;
      pointer-events: none;
      opacity: 0;
      transition: opacity .3s ease;
    }
    .blood-overlay.active { opacity: 1; pointer-events: none; }

    .blood-drop {
      transform-origin: center top;
      animation: fall-and-stretch 1000ms ease forwards;
      filter: blur(.2px);
    }
    @keyframes fall-and-stretch {
      0% { transform: translateY(-40vh) scaleY(.2) scaleX(.9); opacity: .0; }
      35% { opacity: 1; }
      80% { transform: translateY(10vh) scaleY(1.2) scaleX(.95); }
      100% { transform: translateY(40vh) scaleY(.9) scaleX(.98); opacity: .95; }
    }

    .blood-curtain {
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(138,3,3,0.9), rgba(20,6,6,.85));
      clip-path: polygon(0 0, 100% 0, 100% 0, 0 0);
      transition: clip-path .9s cubic-bezier(.22,.9,.35,1);
    }
    .blood-curtain.open {
      clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
    }

    .event-right { flex:0 0 260px; text-align:right; min-width:220px; }
    .event-meta { color:var(--muted); font-size:14px; margin-bottom:8px; }

    @media (max-width:700px){
      .event-right{text-align:left}
    }

    /* small utilities */
    input, select { padding:8px;border-radius:8px;border:1px solid #333;background:transparent;color:inherit }
    label{font-size:13px;color:var(--muted)}
    button{font-family:inherit}
  </style>
</head>
<body>
  <!-- particles background -->
  <div id="tsparticles" aria-hidden="true"></div>

  <!-- Blood SVG overlay (hidden by default) -->
  <div id="bloodOverlay" class="blood-overlay" aria-hidden="true">
    <svg width="100%" height="100%" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="dropGrad" cx="50%" cy="30%" r="60%">
          <stop offset="0%" stop-color="#ff4158" />
          <stop offset="100%" stop-color="#6b0000" />
        </radialGradient>
      </defs>

      <g id="drops">
        <ellipse class="blood-drop" cx="120" cy="-120" rx="36" ry="60" fill="url(#dropGrad)"></ellipse>
        <ellipse class="blood-drop" cx="300" cy="-220" rx="24" ry="46" fill="url(#dropGrad)"></ellipse>
        <ellipse class="blood-drop" cx="520" cy="-150" rx="30" ry="52" fill="url(#dropGrad)"></ellipse>
        <ellipse class="blood-drop" cx="760" cy="-200" rx="40" ry="70" fill="url(#dropGrad)"></ellipse>
        <ellipse class="blood-drop" cx="980" cy="-140" rx="28" ry="50" fill="url(#dropGrad)"></ellipse>
      </g>

      <rect class="blood-curtain" x="0" y="0" width="1200" height="800" fill="rgba(0,0,0,0)"></rect>
    </svg>
  </div>

  <!-- header -->
  <div class="menu-top">
    <img class="logo" src="https://i.postimg.cc/90gRT1n1/Frame-2.png" alt="TMA Logo" />
    <div class="social-links">
      <span class="social-title">Наши соцсети</span>
      <a href="#" class="social-link tg-link" data-link="https://t.me/limitedclubcpa" data-social="telegram"><i class="fab fa-telegram-plane"></i></a>
      <a href="https://www.instagram.com/thelimitedclub.cpa?igsh=MXkwcXppMWtlZGtm" target="_blank" class="social-link" data-social="instagram"><i class="fab fa-instagram"></i></a>
    </div>
  </div>

  <!-- carousel -->
  <div class="carousel" aria-hidden="true">
    <a href="#" class="active" aria-hidden="false"><img src="https://i.postimg.cc/bJqQWjv5/photo-2025-03-18-15-18-14.jpg" alt="photo" /></a>
    <a href="#" aria-hidden="true"><img src="https://i.postimg.cc/Z57qjBRv/feat-mac.jpg" alt="feat" /></a>
    <div class="carousel-dots" aria-hidden="true"><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
  </div>

  <!-- nav -->
  <nav class="menu" aria-label="Главное меню">
    <ul>
      <li class="menu-item active" data-section="home" role="button" tabindex="0">Главная</li>
      <li class="menu-item" data-section="articles" role="button" tabindex="0">Статьи</li>
      <li class="menu-item" data-section="cases" role="button" tabindex="0">Кейсы</li>
      <li class="menu-item" data-section="vacancies" role="button" tabindex="0">Вакансии</li>
      <li class="menu-item" data-section="events" role="button" tabindex="0">Мероприятия</li>
    </ul>
  </nav>

  <!-- sections -->
  <section id="home" class="section active" aria-labelledby="homeTitle">
    <h2 id="homeTitle" class="section-title">АКТУАЛЬНОЕ</h2>
    <p style="color:var(--muted)">Контент главной секции — сюда можно вернуть твой существующий контент.</p>
  </section>

  <section id="articles" class="section" aria-labelledby="articlesTitle"><h2 id="articlesTitle" class="section-title">СТАТЬИ</h2></section>
  <section id="cases" class="section" aria-labelledby="casesTitle"><h2 id="casesTitle" class="section-title">КЕЙСЫ</h2></section>
  <section id="vacancies" class="section" aria-labelledby="vacanciesTitle"><h2 id="vacanciesTitle" class="section-title">ВАКАНСИИ</h2></section>

  <!-- EVENTS -->
  <section id="events" class="section" aria-labelledby="eventsTitle" role="region">
    <h2 id="eventsTitle" class="section-title">МЕРОПРИЯТИЯ</h2>

    <div id="eventContainer" class="event-hero" aria-hidden="false">
      <div class="event-left">
        <h3 class="event-title">Тёмный Бал — Русская Готика</h3>
        <p class="event-sub">
          Вечер в духе старых аллей, свечей и бархатных занавесей. Выступления, закрытый бар и нетворкинг.
        </p>
        <div class="event-cta">
          <button id="openEventBtn" class="btn-register" aria-haspopup="dialog">Узнать детали & зарегистрироваться</button>
          <button id="previewBtn" class="btn-info">Превью анимации</button>
        </div>
      </div>

      <div class="event-right">
        <div class="event-meta">Дата: 13 дек. 2025</div>
        <div class="event-meta">Место: &lt;секретное&gt; (Москва)</div>
        <div class="event-meta">Dress-code: Русская готика</div>
      </div>
    </div>

    <p style="color:var(--muted);margin-top:12px">Нажмите на кнопку — проиграется анимация и страница преобразится в стилистику мероприятия.</p>
  </section>

  <!-- modal template -->
  <div id="eventModalTemplate" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Регистрация на мероприятие">
      <h3>Регистрация: Тёмный Бал — Русская Готика</h3>
      <p>Заполни форму — мы подтвердим участие и пришлём все детали в телеграм.</p>
      <form class="apply-form" action="#" style="display:flex;flex-direction:column;gap:8px;">
        <label>Как Вас зовут?</label>
        <input name="name" placeholder="Иван Иванов" required>
        <label>Telegram (@username)</label>
        <input name="telegram" placeholder="@username" required pattern="@[A-Za-z0-9_]{5,}">
        <label>Email (опционально)</label>
        <input name="email" type="email" placeholder="mail@example.com">
        <label>Билеты</label>
        <select name="tickets" required>
          <option value="" disabled selected>Выберите</option>
          <option value="1">1 — стандарт</option>
          <option value="2">2 — пара</option>
          <option value="vip">VIP</option>
        </select>
        <input type="hidden" name="event_id" value="dark_ball_2025">
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button type="submit" class="bot-button" style="background:linear-gradient(135deg,var(--gothic-accent),#5a0000);color:#fff;border-radius:8px;padding:8px 12px;border:none">Отправить</button>
          <button type="button" class="close-button">Отмена</button>
        </div>
      </form>
    </div>
  </div>

  <!-- scripts -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <script>
    AOS.init({ duration:800, once:true, offset:100 });
    window.addEventListener('load', () => AOS.refresh());

    // ---- Настройки отправки ----
    const SHEET_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxRK9cnnKCBM4AypS_cPFlYWkowUfBRiwFHbHYBcWNREHuy25nx1JvUVatPtVk1BzU_Mw/exec';
    function sendToSheet(data){
      console.log('sendToSheet', data);
      fetch(SHEET_ENDPOINT, {
        method: 'POST', mode: 'no-cors', headers: {'Content-Type':'application/json'}, body: JSON.stringify(data)
      }).catch(e => console.error('sheet error', e));
    }

    function generateUUID(){ return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){ const r=Math.random()*16|0, v=c==='x'?r:(r&0x3|0x8); return v.toString(16); }); }

    // ---- particles defaults ----
    const defaultParticlesConfig = {
      fpsLimit: 60,
      particles: {
        number:{value:200,density:{enable:true,value_area:800}},
        color:{value:"#d5fd02"},
        shape:{type:"circle"},
        opacity:{value:0.5,random:true},
        size:{value:2,random:{enable:true,minimumValue:0.5}},
        links:{enable:false},
        move:{enable:true,speed:0.5,random:true,outModes:{default:"out"}}
      },
      interactivity:{events:{onHover:{enable:false}},resize:true},
      detectRetina:true
    };
    async function initParticles(config = defaultParticlesConfig){
      try{
        await tsParticles.load('tsparticles', config);
      }catch(e){ console.error('tsParticles error', e); }
    }
    initParticles();

    // ---- blood + mice setup ----
    const bloodOverlay = document.getElementById('bloodOverlay');
    const curtain = bloodOverlay.querySelector('.blood-curtain');
    const drops = Array.from(bloodOverlay.querySelectorAll('.blood-drop'));

    drops.forEach((d,i) => {
      d.style.animationDelay = (i * 120) + 'ms';
      d.style.transform = 'translateY(-100vh) scaleY(.2)';
    });

    const mouseSvg = `
      <svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'>
        <path fill='#0b0b0b' d='M47.5 20c-3 0-5.5 2.5-6 5-1.5 0-3 1-3 3 0 .5.2 1 .4 1.5-1.6.7-3.2 1.5-4.6 2.4-2 1.3-3.8 2.8-5.2 4.5-1.6 2-2.8 4.3-3.4 6.8-.3.9.4 1.9 1.4 2 1.8.2 3.6.3 5.4.3 8.5 0 15.5-3 19.5-7.2 3.3-3.6 3.9-8.3 3.9-9.5 0-5.7-4.8-10.4-10.9-10.9z'/>
      </svg>`.trim();
    const mouseDataUrl = 'data:image/svg+xml;utf8,' + encodeURIComponent(mouseSvg);

    const miceConfig = {
      fpsLimit: 60,
      particles: {
        number:{value:40,density:{enable:false}},
        shape:{type:'image', image: [{src: mouseDataUrl, width:64, height:64}]},
        size:{value:{min:8,max:18}},
        move:{enable:true,speed:4,direction:'top-right',random:true,outModes:{default:'out'}},
        opacity:{value:0.9},
        rotate:{value:{min:0,max:360},animation:{enable:true,speed:30}},
      },
      interactivity:{events:{onHover:{enable:false}, onClick:{enable:false}},resize:true},
      detectRetina:true
    };

    async function playGothicTransition({showMice=true} = {}){
      document.body.style.pointerEvents = 'none';
      bloodOverlay.classList.add('active');

      drops.forEach(d => {
        d.style.animation = 'none';
        void d.offsetWidth;
        d.style.animation = '';
      });

      setTimeout(() => { curtain.classList.add('open'); }, 500);
      setTimeout(() => { document.documentElement.classList.add('gothic'); }, 1000);

      if(showMice){
        setTimeout(async () => {
          try { await tsParticles.load('tsparticles', miceConfig); } catch(e){ console.error(e); }
        }, 1200);
      }

      setTimeout(() => {
        bloodOverlay.classList.remove('active');
        curtain.classList.remove('open');
        document.body.style.pointerEvents = '';
      }, 2600);
    }

    // ---- navigation and interactions ----
    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', async () => {
        document.querySelectorAll('.section').forEach(sec => sec.classList.toggle('active', sec.id === item.dataset.section));
        document.querySelectorAll('.menu-item').forEach(i => i.classList.toggle('active', i === item));
        window.scrollTo({top:0,behavior:'smooth'});

        if(item.dataset.section === 'events'){
          playGothicTransition({showMice:true});
        } else {
          setTimeout(() => {
            initParticles(defaultParticlesConfig);
            document.documentElement.classList.remove('gothic');
          }, 500);
        }
      });

      // keyboard accessibility
      item.addEventListener('keydown', (e) => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); item.click(); } });
    });

    document.getElementById('previewBtn').addEventListener('click', () => playGothicTransition({showMice:true}));

    // registration modal
    const openEventBtn = document.getElementById('openEventBtn');
    openEventBtn.addEventListener('click', (e) => { e.preventDefault(); openEventRegistration(); });

    function openEventRegistration(){
      const tpl = document.getElementById('eventModalTemplate').innerHTML;
      const wrapper = document.createElement('div');
      wrapper.innerHTML = tpl;
      const modal = wrapper.firstElementChild;
      document.body.appendChild(modal);
      setTimeout(() => modal.classList.add('active'), 10);
      document.body.classList.add('modal-open');

      // close
      modal.querySelector('.close-button').addEventListener('click', () => {
        modal.classList.remove('active');
        document.body.classList.remove('modal-open');
        setTimeout(()=> modal.remove(), 600);
      });

      // submit
      modal.querySelector('form').addEventListener('submit', (ev) => {
        ev.preventDefault();
        const fd = new FormData(ev.target);
        const name = fd.get('name') || '';
        const telegram = fd.get('telegram') || '';
        const tickets = fd.get('tickets') || '';
        if(!telegram || !telegram.startsWith('@')){
          alert('Пожалуйста, укажите корректный Telegram (@username).');
          return;
        }
        const regId = generateUUID();
        const payload = {
          event: 'event_registration',
          event_id: 'dark_ball_2025',
          registration_id: regId,
          name, telegram, tickets,
          userAgent: navigator.userAgent,
          timestamp: new Date().toISOString()
        };
        sendToSheet(payload);

        const formWrap = modal.querySelector('.apply-form');
        formWrap.innerHTML = `<p style="text-align:center;color:var(--gothic-gold);font-weight:700">Регистрация отправлена!</p>
                              <p style="text-align:center;color:var(--muted)">Мы свяжемся в Telegram для подтверждения.</p>
                              <div style="text-align:center;margin-top:12px">
                                <button class="close-button" style="padding:8px 12px">Закрыть</button>
                              </div>`;
        modal.querySelector('.close-button').addEventListener('click', () => {
          modal.classList.remove('active');
          document.body.classList.remove('modal-open');
          setTimeout(()=> modal.remove(), 600);
        });
      });
    }

    // carousel
    function startCarousel(){
      const slides = document.querySelectorAll('.carousel a');
      const dots = document.querySelectorAll('.carousel-dots .dot');
      let currentIndex = 0;
      function showSlide(index){
        slides.forEach((s,i)=> s.classList.toggle('active', i===index));
        dots.forEach((d,i)=> d.classList.toggle('active', i===index));
        currentIndex = index;
      }
      function nextSlide(){ currentIndex = (currentIndex+1)%slides.length; showSlide(currentIndex); }
      setInterval(nextSlide,3000);
      showSlide(0);
    }
    startCarousel();

    // telegram links
    document.querySelectorAll('.tg-link').forEach(el => {
      el.addEventListener('click', function(e){
        e.preventDefault();
        const link = this.dataset.link;
        if (/^https:\/\/t\.me\//.test(link) && window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.openLink(link);
        } else {
          window.open(link, '_blank');
        }
      });
    });
  </script>
</body>
</html>
