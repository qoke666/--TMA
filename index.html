<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ТМA — Мероприятие (демо)</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#070707;
    --fg:#efe7de;
    --muted:#bfb6ab;
    --accent:#c63a3a; /* gothic red */
    --gold:#b88b2f;
    --card:#111011;
    --transition: 520ms;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--fg);-webkit-font-smoothing:antialiased}
  a{color:inherit}

  /* header */
  .top {
    display:flex;align-items:center;justify-content:space-between;padding:14px 18px;gap:12px;
  }
  .logo { height:44px; transition:transform var(--transition) ease,opacity var(--transition) ease; }
  .logo.hidden { transform: translateY(-10px) scale(.9); opacity:0; pointer-events:none; }

  .banner { width:360px; height:140px; border-radius:8px; overflow:hidden; transition:transform var(--transition) ease,opacity var(--transition) ease; }
  .banner img{width:100%;height:100%;object-fit:cover;display:block}
  .banner.hidden { transform: translateY(-8px) scale(.98); opacity:0; pointer-events:none; }

  .social { display:flex; gap:10px; color:var(--muted); font-size:18px; align-items:center }

  /* nav */
  nav { display:flex; justify-content:center; background:transparent; padding:10px 8px; position:sticky; top:0; z-index:40; }
  nav ul{ display:flex; gap:10px; margin:0; padding:0; list-style:none }
  .nav-item { padding:8px 12px; border-radius:8px; color:var(--muted); cursor:pointer; font-weight:600; transition:background .18s, color .18s; }
  .nav-item:hover { background:rgba(255,255,255,0.03); color:var(--fg) }
  .nav-item.event { background: linear-gradient(180deg,var(--accent),#6b0f0f); color:#fff; box-shadow: 0 6px 26px rgba(198,58,58,0.16); }

  /* main layout */
  main { padding:20px; min-height:60vh; max-width:1100px; margin:0 auto; position:relative; z-index:10 }
  .lead { color:var(--muted); margin:8px 0 18px }

  /* event hero (the target) */
  .event { display:flex; gap:18px; padding:22px; border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.18));
    border:1px solid rgba(255,255,255,0.03);
    align-items:center;
    transform-origin:top center;
    opacity:0; transform:translateY(18px) scale(.995); transition:opacity .6s ease, transform .6s cubic-bezier(.2,.9,.25,1);
  }
  .event.show { opacity:1; transform:translateY(0) scale(1); }
  .event-left { flex:1; min-width:260px }
  .event-title { font-family:Cinzel, serif; color:var(--gold); font-size:32px; margin:0 0 8px; text-shadow:0 6px 18px rgba(0,0,0,0.6) }
  .event-desc { color:var(--muted); margin:0 0 14px }
  .event-cta { display:flex; gap:10px; flex-wrap:wrap }

  .btn-register { background:linear-gradient(180deg,var(--accent),#6b0f0f); color:#fff; border:none; padding:10px 16px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow:0 10px 28px rgba(198,58,58,0.18); transition:transform .18s }
  .btn-register:hover{ transform:translateY(-3px) }

  .info { text-align:right; min-width:200px; color:var(--muted) }

  /* simple inline registration (no modal) */
  .reg-form { margin-top:14px; display:flex; gap:8px; flex-wrap:wrap; align-items:center }
  .reg-form input, .reg-form select { padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(0,0,0,0.18); color:var(--fg) }

  /* canvas overlay */
  #batCanvas { position:fixed; inset:0; z-index:60; pointer-events:none; opacity:0; transition:opacity .45s ease; will-change:transform }
  #batCanvas.active { opacity:1 }

  /* velvet filter (dark red tint during transition) */
  .velvet { position:fixed; inset:0; z-index:55; background:radial-gradient(circle at 20% 10%, rgba(255,200,200,0.02), rgba(8,2,2,0.86)); pointer-events:none; opacity:0; transition:opacity .45s ease }
  .velvet.show { opacity:1 }

  /* curtain for dramatic slide (subtle) */
  .curtain { position:fixed; inset:0; z-index:58; background:linear-gradient(180deg, rgba(9,3,3,0.96), rgba(8,2,2,0.9)); transform:translateY(-100%); transition:transform .65s cubic-bezier(.22,.9,.35,1); pointer-events:none }
  .curtain.open { transform:translateY(0) }

  /* small loading ring while bat image loads (keeps UX neat) */
  .loader { position:fixed; left:50%; top:28%; transform:translate(-50%,-50%); z-index:70; display:none; align-items:center; gap:8px; color:var(--muted) }
  .loader.show{ display:flex }

  /* responsive */
  @media (max-width:720px){
    .banner{display:none}
    .event { flex-direction:column; text-align:left }
    .info { text-align:left }
  }
</style>
</head>
<body>

  <!-- top header -->
  <div class="top">
    <img class="logo" id="logo" src="https://i.postimg.cc/90gRT1n1/Frame-2.png" alt="logo">
    <div class="banner" id="banner">
      <img src="https://i.postimg.cc/bJqQWjv5/photo-2025-03-18-15-18-14.jpg" alt="banner">
    </div>
    <div class="social">
      <a href="#" aria-label="tg"> <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 3L3 10.5l5 1.5L9.5 21 12 16l9-13z" fill="#bfb6ab"/></svg></a>
    </div>
  </div>

  <!-- nav -->
  <nav>
    <ul>
      <li class="nav-item" data-section="home">Главная</li>
      <li class="nav-item" data-section="about">О нас</li>
      <li class="nav-item nav-event event" id="eventBtn" title="Мероприятие — Тёмный Бал">Мероприятия</li>
      <li class="nav-item" data-section="contacts">Контакты</li>
    </ul>
  </nav>

  <!-- main -->
  <main>
    <h1 style="font-family:Cinzel,serif;color:var(--gold);margin:0 0 8px">The Limited Club</h1>
    <p class="lead">Кратко про нас. Нажми «Мероприятия» — увидишь красивое перевоплощение в готическую атмоcферу.</p>

    <!-- target event (hidden until transition) -->
    <article class="event" id="eventCard" aria-hidden="true">
      <div class="event-left">
        <h2 class="event-title">Тёмный Бал — Русская Готика</h2>
        <p class="event-desc">Ночь свечей, бархатных занавесей и тихих разговоров. Выступления, эксклюзивный бар и нетворкинг с лидерами рынка.</p>

        <div class="event-cta">
          <button class="btn-register" id="registerBtn">Зарегистрироваться</button>
        </div>

        <form class="reg-form" id="regForm" style="display:none">
          <input name="name" id="name" placeholder="Имя" required />
          <input name="telegram" id="telegram" placeholder="@username" pattern="@[A-Za-z0-9_]{5,}" required />
          <select name="tickets" id="tickets" required>
            <option value="">Билет</option>
            <option value="1">1 — стандарт</option>
            <option value="2">2 — пара</option>
            <option value="vip">VIP</option>
          </select>
          <button type="submit" class="btn-register">Отправить</button>
        </form>

      </div>

      <div class="info">
        <div>Дата: 13 дек. 2025</div>
        <div>Место: Москва (по приглашениям)</div>
        <div>Dress-code: Русская готика</div>
      </div>
    </article>
  </main>

  <!-- canvas for bats -->
  <canvas id="batCanvas" aria-hidden="true"></canvas>

  <!-- velvet / curtain layers -->
  <div class="velvet" id="velvet" aria-hidden="true"></div>
  <div class="curtain" id="curtain" aria-hidden="true"></div>

  <!-- loader while assets preload -->
  <div class="loader" id="loader"><svg width="24" height="24" viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" stroke="rgba(255,255,255,0.08)" stroke-width="6" fill="none"/><path d="M25 5a20 20 0 0 1 0 40" stroke="var(--muted)" stroke-width="6" fill="none" stroke-linecap="round"/></svg> Загружаю эффект...</div>

<script>
/* ==============
  Настройки (правь тут)
   ============== */
const SHEET_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxRK9cnnKCBM4AypS_cPFlYWkowUfBRiwFHbHYBcWNREHuy25nx1JvUVatPtVk1BzU_Mw/exec';
const FPS_LIMIT = 45; // ограничим до 45fps
const DENSITY_DESKTOP = 120;
const DENSITY_TABLET = 70;
const DENSITY_MOBILE = 36;

/* ==============
  Вспомогалки
   ============== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

function sendToSheet(data){
  fetch(SHEET_ENDPOINT, { method: 'POST', mode: 'no-cors', headers: {'Content-Type':'application/json'}, body: JSON.stringify(data) })
    .catch(e => console.log('sheet err', e));
}

/* ==============
  Bat canvas system (lightweight, optimized)
   ============== */
const canvas = $('#batCanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;
window.addEventListener('resize', () => { W = canvas.width = innerWidth; H = canvas.height = innerHeight; });

/* prepare bat image - SVG dataURI (crisp vector) */
const batSVG = `<svg xmlns='http://www.w3.org/2000/svg' width='160' height='96' viewBox='0 0 160 96'><g fill="none" fill-rule="evenodd"><path d="M6 55c14-12 28-24 44-22 10 1 19 7 26 12 7-5 16-11 26-12 16-2 30 10 44 22-12-12-28-20-44-16-11 3-19 9-24 12-5-3-13-9-24-12-16-4-32 4-44 16z" fill="#0b0b0b"/><ellipse cx="80" cy="60" rx="24" ry="12" fill="#0b0b0b" /></g></svg>`;
const batImg = new Image();
batImg.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(batSVG);

let bats = [];
let rafId = null;
let last = performance.now();
let running = false;
let targetFPS = FPS_LIMIT;
let frameInterval = 1000 / targetFPS;

/* Bat particle */
class Bat {
  constructor(init=false){
    this.reset(init);
  }
  reset(init=false){
    this.x = Math.random() * W;
    this.y = init ? Math.random() * H : -20 - Math.random() * H * 0.6;
    this.vx = (Math.random() * 2 - 1) * (0.6 + Math.random() * 1.8);
    this.vy = 0.4 + Math.random() * 1.1;
    this.amp = 8 + Math.random() * 28;
    this.freq = 0.007 + Math.random() * 0.03;
    this.t = Math.random() * 1000;
    this.size = (10 + Math.random()*28);
    this.rot = (Math.random()*40 - 20) * Math.PI/180;
    this.opacity = 0.12 + Math.random() * 0.9;
    this.depth = Math.random();
  }
  update(dt){
    this.t += dt * 0.001;
    this.x += this.vx * (1 + this.depth * 1.5);
    this.y += this.vy * (1 + this.depth * 1.5);
    this.ox = Math.sin(this.t * (0.9 + this.freq * 100)) * this.amp;
    this.rot += Math.sin(this.t * 2.5) * 0.02;
    if(this.y > H + 100 || this.x < -200 || this.x > W + 200){
      this.reset(false);
      this.y = -20 - Math.random() * 120;
      this.x = Math.random() * W;
    }
  }
  draw(ctx){
    if(!batImg.complete) return;
    ctx.save();
    ctx.globalAlpha = Math.min(1, this.opacity * (0.6 + this.depth*0.8));
    const s = (this.depth*0.6 + 0.7) * (this.size / 48);
    const w = batImg.width * s;
    const h = batImg.height * s;
    ctx.translate(this.x + (this.ox||0), this.y);
    ctx.rotate(this.rot);
    ctx.drawImage(batImg, -w/2, -h/2, w, h);
    ctx.restore();
  }
}

/* spawn according to device */
function getDensity(){
  const w = Math.max(innerWidth, innerHeight);
  if(w < 720) return DENSITY_MOBILE;
  if(w < 1100) return DENSITY_TABLET;
  return DENSITY_DESKTOP;
}
function spawn(count){
  bats = [];
  for(let i=0;i<count;i++){
    bats.push(new Bat(true));
  }
}

/* render loop with FPS cap */
function loop(now){
  rafId = requestAnimationFrame(loop);
  const elapsed = now - last;
  if(elapsed < frameInterval) return; // cap fps
  last = now - (elapsed % frameInterval);
  ctx.clearRect(0,0,W,H);
  // optional subtle global glow
  for(const b of bats){
    b.update(elapsed);
    b.draw(ctx);
  }
}

/* show/hide control */
function showBats(dense=true){
  const el = canvas;
  const count = dense ? getDensity() : Math.floor(getDensity()/3);
  spawn(count);
  el.classList.add('active');
  if(!running){
    running = true;
    last = performance.now();
    rafId = requestAnimationFrame(loop);
  }
}
function hideBats(){
  canvas.classList.remove('active');
  // gracefully stop after short delay so last frame finishes
  setTimeout(()=> {
    if(rafId) cancelAnimationFrame(rafId);
    running = false;
    bats = [];
    // clear canvas
    ctx.clearRect(0,0,W,H);
  }, 420);
}

/* ==============
  Transition logic (button click)
   ============== */
const eventBtn = $('#eventBtn');
const logo = $('#logo');
const banner = $('#banner');
const curtain = $('#curtain');
const velvet = $('#velvet');
const loader = $('#loader');
const eventCard = $('#eventCard');
const registerBtn = $('#registerBtn');
const regForm = $('#regForm');

function dramaticTransition(){
  // 1) show curtain quickly
  curtain.classList.add('open');
  velvet.classList.add('show');

  // 2) show loader until batImg loaded (keeps UX smooth)
  loader.classList.add('show');

  // ensure bat image is loaded before dense spawn
  batImg.decode ? batImg.decode().catch(()=>{}).then(() => afterPreload(true)) : batImg.onload = () => afterPreload(true);

  // fallback in 1.2s if image fails
  setTimeout(()=> {
    if(loader.classList.contains('show')) afterPreload(true);
  }, 1200);
}

function afterPreload(dense){
  // hide loader
  loader.classList.remove('show');

  // hide header elements with grace
  logo.classList.add('hidden');
  banner.classList.add('hidden');

  // small delay then start bats
  setTimeout(()=> {
    showBats(dense);
  }, 220);

  // after 1.1s reveal event card and remove curtain
  setTimeout(()=> {
    eventCard.classList.add('show');
    eventCard.setAttribute('aria-hidden','false');
    // fade curtain out
    curtain.classList.remove('open');
    // keep velvet to keep mood but subtle
    setTimeout(()=> velvet.classList.remove('show'), 800);
    // then hide bats gradually but keep a few for mood
    setTimeout(()=> {
      // replace dense with lighter swarm for ambient (slower)
      showBats(false);
      // hide bats fully after more time so user can interact
      setTimeout(()=> hideBats(), 2500);
    }, 800);
  }, 1100);
}

// attach
eventBtn.addEventListener('click', () => {
  dramaticTransition();
  // also scroll to eventCard area after a bit
  setTimeout(()=> eventCard.scrollIntoView({behavior:'smooth', block:'center'}), 1200);
});

/* ==============
  Registration (inline form)
   ============== */
registerBtn.addEventListener('click', () => {
  regForm.style.display = regForm.style.display === 'flex' ? 'none' : 'flex';
  // set flex layout
  regForm.style.display = 'flex';
});

regForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const name = (document.getElementById('name') || {}).value || '';
  const telegram = (document.getElementById('telegram') || {}).value || '';
  const tickets = (document.getElementById('tickets') || {}).value || '';
  if(!telegram || !telegram.startsWith('@')) { alert('Укажите корректный Telegram (@username)'); return; }
  const payload = { event: 'registration', id: cryptoRandomId(), name, telegram, tickets, ts: new Date().toISOString(), ua: navigator.userAgent };
  sendToSheet(payload);

  // polite inline feedback
  regForm.innerHTML = `<div style="color:var(--gold);font-weight:700">Спасибо — заявка получена</div><div style="color:var(--muted);margin-top:8px">Мы свяжемся в Telegram для подтверждения.</div>`;
});

/* tiny UUID replacement */
function cryptoRandomId(){
  // short random id
  return 'id-' + Math.random().toString(36).slice(2,9);
}

/* ==============
  Graceful keyboard/other nav: clicking other nav items reverts visuals
   ============== */
$$('.nav-item').forEach(item => {
  item.addEventListener('click', (e) => {
    // if clicked on eventBtn we already handled above
    if(item.id === 'eventBtn') return;
    // revert visuals
    logo.classList.remove('hidden');
    banner.classList.remove('hidden');
    eventCard.classList.remove('show');
    eventCard.setAttribute('aria-hidden','true');
    velvet.classList.remove('show');
    hideBats();
    curtain.classList.remove('open');
  });
});

/* ensure canvas size correct on load */
function resizeCanvas(){
  W = canvas.width = innerWidth;
  H = canvas.height = innerHeight;
}
window.addEventListener('resize', resizeCanvas);

/* initial canvas sizing */
resizeCanvas();

</script>
</body>
</html>
