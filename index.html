<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>The Limited Club — Мероприятие</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#070707; --fg:#efe7de; --muted:#bfb6ab;
    --accent:#b23b3b; --gold:#b88b2f;
    --transition:520ms;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--fg)}
  a{color:inherit}

  /* header */
  .top{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;gap:12px;z-index:20}
  .logo{height:44px;transition:transform var(--transition) ease,opacity var(--transition) ease}
  .logo.hidden{transform:translateY(-10px) scale(.9);opacity:0;pointer-events:none}
  .banner{width:300px;height:120px;border-radius:8px;overflow:hidden;transition:transform var(--transition) ease,opacity var(--transition) ease}
  .banner.hidden{transform:translateY(-8px) scale(.98);opacity:0;pointer-events:none}
  .banner img{width:100%;height:100%;object-fit:cover;display:block}

  /* nav */
  nav{display:flex;justify-content:center;padding:10px 8px;position:sticky;top:0;background:transparent;z-index:30}
  nav ul{display:flex;gap:10px;margin:0;padding:0;list-style:none}
  .nav-item{padding:8px 12px;border-radius:8px;color:var(--muted);cursor:pointer;font-weight:600;transition:background .18s,color .18s}
  .nav-item:hover{background:rgba(255,255,255,0.03);color:var(--fg)}
  .nav-item.event{background:linear-gradient(180deg,var(--accent),#611010);color:#fff;box-shadow:0 6px 20px rgba(178,59,59,.14)}

  main{max-width:1100px;margin:18px auto;padding:16px;position:relative;z-index:10}
  h1{font-family:Cinzel,serif;color:var(--gold);margin:0 0 8px}

  /* event card (hidden until shown) */
  .event{display:flex;gap:18px;padding:20px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.12));border:1px solid rgba(255,255,255,0.02);align-items:center;opacity:0;transform:translateY(14px) scale(.995);transition:opacity .55s ease,transform .55s cubic-bezier(.2,.9,.25,1)}
  .event.show{opacity:1;transform:translateY(0) scale(1)}
  .event-left{flex:1;min-width:260px}
  .event-title{font-family:Cinzel,serif;color:var(--gold);font-size:30px;margin:0 0 6px}
  .event-desc{color:var(--muted);margin:0 0 12px}
  .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
  .btn.primary{background:linear-gradient(180deg,var(--accent),#611010);color:#fff;box-shadow:0 10px 26px rgba(178,59,59,.14)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

  .info{text-align:right;color:var(--muted);min-width:200px}

  /* inline form (simple) */
  .reg-form{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .reg-form input,.reg-form select{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(0,0,0,0.14);color:var(--fg)}

  /* canvas & filters */
  #batCanvas{position:fixed;inset:0;z-index:60;pointer-events:none;opacity:0;transition:opacity .45s ease}
  #batCanvas.on{opacity:1}
  .velvet{position:fixed;inset:0;z-index:55;background:radial-gradient(circle at 20% 10%,rgba(255,200,200,0.02),rgba(8,2,2,0.86));pointer-events:none;opacity:0;transition:opacity .45s ease}
  .velvet.on{opacity:1}
  .curtain{position:fixed;inset:0;z-index:58;background:linear-gradient(180deg,rgba(9,3,3,0.96),rgba(8,2,2,0.9));transform:translateY(-100%);transition:transform .65s cubic-bezier(.22,.9,.35,1);pointer-events:none}
  .curtain.open{transform:translateY(0)}

  /* loader */
  .loader{position:fixed;left:50%;top:28%;transform:translate(-50%,-50%);z-index:70;display:none;color:var(--muted)}
  .loader.show{display:flex;gap:8px;align-items:center}

  @media (max-width:720px){
    .banner{display:none}
    .event{flex-direction:column}
    .info{text-align:left}
  }
</style>
</head>
<body>

  <!-- header -->
  <div class="top">
    <img id="logo" class="logo" src="https://i.postimg.cc/90gRT1n1/Frame-2.png" alt="logo">
    <div id="banner" class="banner"><img src="https://i.postimg.cc/bJqQWjv5/photo-2025-03-18-15-18-14.jpg" alt="banner"></div>
    <div class="social" aria-hidden="true" style="color:var(--muted)"> <span style="opacity:.8">TLC</span></div>
  </div>

  <!-- nav -->
  <nav aria-label="Главное меню">
    <ul>
      <li class="nav-item" data-section="home">Главная</li>
      <li class="nav-item" data-section="about">О нас</li>
      <li id="eventBtn" class="nav-item event" title="Мероприятие">Мероприятия</li>
      <li class="nav-item" data-section="contacts">Контакты</li>
    </ul>
  </nav>

  <main>
    <h1>The Limited Club</h1>
    <p style="color:var(--muted);margin:6px 0 18px">Кликни «Мероприятия» — будет аккуратный эффект перехода, потом секция события с формой регистрации.</p>

    <!-- Event card (hidden initially) -->
    <article id="eventCard" class="event" aria-hidden="true">
      <div class="event-left">
        <h2 class="event-title">Тёмный Бал — Русская Готика</h2>
        <p class="event-desc">Ночь свечей и бархата. Выступления, закрытый бар, нетворкинг. Простой вход по подтверждению.</p>

        <div>
          <button id="showForm" class="btn primary">Зарегистрироваться</button>
          <button id="preview" class="btn ghost" style="margin-left:8px">Превью анимации</button>
        </div>

        <form id="regForm" class="reg-form" style="display:none" onsubmit="return false;">
          <input id="name" name="name" placeholder="Имя" required>
          <input id="telegram" name="telegram" placeholder="@username" pattern="@[A-Za-z0-9_]{5,}" required>
          <select id="tickets" name="tickets" required>
            <option value="">Билет</option><option value="1">1 — стандарт</option><option value="2">2 — пара</option><option value="vip">VIP</option>
          </select>
          <button id="send" class="btn primary" type="button">Отправить</button>
        </form>
      </div>

      <div class="info">
        <div>Дата: 13 дек. 2025</div>
        <div>Место: Москва (по подтверждению)</div>
        <div>Dress-code: Русская готика</div>
      </div>
    </article>
  </main>

  <!-- canvas and layers -->
  <canvas id="batCanvas" aria-hidden="true"></canvas>
  <div id="velvet" class="velvet" aria-hidden="true"></div>
  <div id="curtain" class="curtain" aria-hidden="true"></div>

  <div id="loader" class="loader" aria-hidden="true">
    <svg width="22" height="22" viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" stroke="rgba(255,255,255,0.08)" stroke-width="6" fill="none"/><path d="M25 5a20 20 0 0 1 0 40" stroke="var(--muted)" stroke-width="6" fill="none" stroke-linecap="round"/></svg>
    <span style="color:var(--muted)">Загружаю эффект…</span>
  </div>

<script>
/* =============
  Конфиг — правь при необходимости
  ============= */
const SHEET_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxRK9cnnKCBM4AypS_cPFlYWkowUfBRiwFHbHYBcWNREHuy25nx1JvUVatPtVk1BzU_Mw/exec';
const FPS = 45;
const DENSITY_DESKTOP = 110;
const DENSITY_TABLET = 60;
const DENSITY_MOBILE = 36;

/* =============
  Утилиты
  ============= */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function sendToSheet(data){
  // no-cors to match Apps Script common setup
  fetch(SHEET_ENDPOINT, { method: 'POST', mode: 'no-cors', headers: {'Content-Type':'application/json'}, body: JSON.stringify(data) })
    .catch(e => console.log('sheet err', e));
}

/* =============
  Canvas bats (оптимизированный)
  ============= */
const canvas = $('#batCanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;
window.addEventListener('resize', () => { W = canvas.width = innerWidth; H = canvas.height = innerHeight; });

/* bat SVG as image (data URI) — avoids external requests */
const batSVG = `<svg xmlns='http://www.w3.org/2000/svg' width='160' height='96' viewBox='0 0 160 96'><g fill="none" fill-rule="evenodd"><path d="M6 55c14-12 28-24 44-22 10 1 19 7 26 12 7-5 16-11 26-12 16-2 30 10 44 22-12-12-28-20-44-16-11 3-19 9-24 12-5-3-13-9-24-12-16-4-32 4-44 16z" fill="#0b0b0b"/><ellipse cx="80" cy="60" rx="24" ry="12" fill="#0b0b0b" /></g></svg>`;
const batImg = new Image();
batImg.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(batSVG);

/* particles */
let bats = [];
let raf = null;
let last = performance.now();
let running = false;
let fpsInterval = 1000 / FPS;

class Bat {
  constructor(init=false){
    this.reset(init);
  }
  reset(init=false){
    this.x = Math.random() * W;
    this.y = init ? Math.random() * H : -20 - Math.random() * H * 0.6;
    this.vx = (Math.random()*2 - 1) * (0.6 + Math.random()*1.6);
    this.vy = 0.4 + Math.random()*1.1;
    this.amp = 8 + Math.random()*28;
    this.freq = 0.007 + Math.random()*0.03;
    this.t = Math.random() * 1000;
    this.size = (10 + Math.random()*28);
    this.rot = (Math.random()*40 - 20) * Math.PI/180;
    this.opacity = 0.12 + Math.random()*0.9;
    this.depth = Math.random();
  }
  update(dt){
    this.t += dt * 0.001;
    this.x += this.vx * (1 + this.depth * 1.5);
    this.y += this.vy * (1 + this.depth * 1.5);
    this.ox = Math.sin(this.t * (0.9 + this.freq * 100)) * this.amp;
    this.rot += Math.sin(this.t * 2.5) * 0.02;
    if(this.y > H + 100 || this.x < -200 || this.x > W + 200){
      this.reset(false);
      this.y = -20 - Math.random()*120;
      this.x = Math.random() * W;
    }
  }
  draw(){
    if(!batImg.complete) return;
    ctx.save();
    ctx.globalAlpha = Math.min(1, this.opacity * (0.6 + this.depth*0.8));
    const s = (this.depth*0.6 + 0.7) * (this.size / 48);
    const w = batImg.width * s;
    const h = batImg.height * s;
    ctx.translate(this.x + (this.ox||0), this.y);
    ctx.rotate(this.rot);
    ctx.drawImage(batImg, -w/2, -h/2, w, h);
    ctx.restore();
  }
}

function getDensity(){
  const w = Math.max(innerWidth, innerHeight);
  if(w < 720) return DENSITY_MOBILE;
  if(w < 1100) return DENSITY_TABLET;
  return DENSITY_DESKTOP;
}
function spawn(count){
  bats = [];
  for(let i=0;i<count;i++) bats.push(new Bat(true));
}

function loop(now){
  raf = requestAnimationFrame(loop);
  const elapsed = now - last;
  if(elapsed < fpsInterval) return;
  last = now - (elapsed % fpsInterval);
  ctx.clearRect(0,0,W,H);
  for(const b of bats){ b.update(elapsed); b.draw(); }
}

function startBats(dense=true){
  const count = dense ? getDensity() : Math.floor(getDensity()/3);
  spawn(count);
  canvas.classList.add('on');
  if(!running){ running=true; last = performance.now(); raf = requestAnimationFrame(loop); }
}
function stopBats(){
  canvas.classList.remove('on');
  setTimeout(()=> {
    if(raf) cancelAnimationFrame(raf);
    running = false;
    bats = [];
    ctx.clearRect(0,0,W,H);
  }, 300);
}

/* =============
  Transition & UI wiring
  ============= */
const eventBtn = $('#eventBtn');
const logo = $('#logo');
const banner = $('#banner');
const curtain = $('#curtain');
const velvet = $('#velvet');
const loader = $('#loader');
const eventCard = $('#eventCard');
const showForm = $('#showForm');
const regForm = $('#regForm');
const sendBtn = $('#send');

function showEventTransition(){
  curtain.classList.add('open');
  velvet.classList.add('on');
  loader.classList.add('show');

  // ensure batImg is ready — decode() if supported
  const preload = batImg.decode ? batImg.decode().catch(()=>{}) : Promise.resolve();
  // fallback timeout
  const timeout = new Promise(res => setTimeout(res, 900));

  Promise.race([preload, timeout]).then(() => {
    loader.classList.remove('show');
    logo.classList.add('hidden');
    banner.classList.add('hidden');

    setTimeout(()=> startBats(true), 220);

    setTimeout(()=> {
      eventCard.classList.add('show');
      eventCard.setAttribute('aria-hidden', 'false');
      curtain.classList.remove('open');
      setTimeout(()=> velvet.classList.remove('on'), 700);
      // after showing, reduce swarm to ambient
      setTimeout(()=> startBats(false), 900);
      // hide swarm fully later
      setTimeout(()=> stopBats(), 3000);
    }, 1050);
  });
}

// attach click
eventBtn.addEventListener('click', ()=> {
  // prevent re-trigger if already visible
  if(eventCard.classList.contains('show')) {
    // scroll into view instead
    eventCard.scrollIntoView({behavior:'smooth', block:'center'});
    return;
  }
  showEventTransition();
  setTimeout(()=> eventCard.scrollIntoView({behavior:'smooth', block:'center'}), 1200);
});

// preview (short)
$('#preview').addEventListener('click', ()=> {
  curtain.classList.add('open');
  velvet.classList.add('on');
  batImg.decode ? batImg.decode().catch(()=>{}).then(()=> startBats(false)) : startBats(false);
  setTimeout(()=> { curtain.classList.remove('open'); velvet.classList.remove('on'); stopBats(); }, 1200);
});

/* Inline form toggling */
showForm.addEventListener('click', ()=> {
  if(regForm.style.display === 'flex') regForm.style.display = 'none';
  else { regForm.style.display = 'flex'; regForm.style.alignItems = 'center'; }
});

/* send registration */
sendBtn.addEventListener('click', ()=> {
  const name = $('#name').value || '';
  const telegram = $('#telegram').value || '';
  const tickets = $('#tickets').value || '';
  if(!telegram || !telegram.startsWith('@')) { alert('Укажите корректный Telegram (@username)'); return; }
  const payload = { event: 'registration', id: 'id-' + Math.random().toString(36).slice(2,9), name, telegram, tickets, ts: new Date().toISOString(), ua: navigator.userAgent };
  sendToSheet(payload);
  regForm.innerHTML = `<div style="color:var(--gold);font-weight:700">Спасибо — заявка получена</div><div style="color:var(--muted);margin-top:8px">Мы свяжемся в Telegram для подтверждения.</div>`;
});

/* revert visuals when clicking other nav items */
$$('.nav-item').forEach(it => {
  it.addEventListener('click', (e) => {
    if(it === eventBtn) return;
    logo.classList.remove('hidden');
    banner.classList.remove('hidden');
    eventCard.classList.remove('show');
    eventCard.setAttribute('aria-hidden','true');
    velvet.classList.remove('on');
    curtain.classList.remove('open');
    stopBats();
  });
});

/* ensure canvas sizing */
function resizeCanvas(){ W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

</script>
</body>
</html>
